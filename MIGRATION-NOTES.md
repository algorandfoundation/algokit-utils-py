# Migration Notes

A collection of notes to consolidate todos during decoupling efforts (similar doc exists on ts version as well).

## API

### Generator

- Currently generated models for KMD have explicit request models resulting in slightly different signatures in contrast with indexer and algod and requiring imports of explicit typed request models specifically on kmd client calls. Do we want to further refine the generation to auto flatten the keys to ensure it does not define an explicit request models or change those models to TypedDicts to reduce the import overhead?

### Algod OAS

- is_frozen field on models in algod is a boolean in the spec but actual returning value is an integer, serde must be updated to handle casting to bool.

### KMD

- algokit-core repo on a branch called feat/account-manager, we had a minor refinement in OAS spec for kmd adding a default value for wallet driver field as well as the generator adjustments to ensure generated model for related endpoint falls back to default 'sqlite' value. Do we want to restore this approach?:

### Type annotations

- Type hints and documentation now refer to the generated `algokit_algod_client.AlgodClient` (instead of `algosdk.v2client.algod.AlgodClient`). Update any downstream annotations or typing imports accordingly when migrating to v4.

## ABI

- decoding `byte`, `byte[]` and `byte[n]` now results in a python `bytes` type instead of `list[int]`
- encoding `byte` now accepts `bytes` or `int` types
- decoding `ufixed` types now returns a `decimal.Decimal` instead of an `int`
- encoding `ufixed` types now accepts a `decimal.Decimal` or an `int`
- tuple types decode to `tuple` instead of `list`

### ABI return naming

- Decide on naming for `ABIReturn` fields (e.g. `value` vs `return_value`, `raw_value` vs `raw_return_value`).
- Current branch aligns with the Rust approach where SDK and ABI variants of `ABIReturn` are merged into one abstraction; do we keep the same approach in the TS equivalent?

## AlgoSDK primitives

- What do we do with SourceMap abstraction? AlgoSDK version is more feature complete, while we also have a simple autogenerated sourcemap variant in algosdk. ts currently relies on ProgramSourceMap which is vendored from js algosdk. Do we drop the vendored variants completely and enhance api generator to hand roll a custom sourcemap variant we need and rely on that everywhere? Or do we move the vendored source map variant into the algokit-utils and enhance it there?

- BoxReference used to be a subclass of algosdk BoxReference, now there is a direct equivalent imported from transact package. Do we want to keep aliasing the BoxReference to transact version or do we want to deprecate and advice consumers to import directly from transact?
